import{a as l,j as e}from"./index-BO0yLXil.js";import{u as N,b as d,f as v,t as h,s as u,y as c,c as y,d as C}from"./App-LylB1B2x.js";import{u as b}from"./MainRoute-Bt48PBj6.js";const E=({setMessages:m})=>{const a=N(),{isSidebarOpen:p}=d(s=>s.ui),{chats:f,currentChat:x}=d(s=>s.chat),o=b(),[n,i]=l.useState(null);l.useEffect(()=>{a(v())},[a]),l.useEffect(()=>{(async()=>{try{const t=await fetch("https://nexo-chat-bot.onrender.com/api/auth/fetchUser",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok){i(null);return}const r=await t.json();r?.user?i(r.user):i(null)}catch{i(null)}})()},[]);const j=async()=>{const s=prompt("Enter chat title");if(s)try{const t=await a(y(s)).unwrap();if(t.chat){const r={id:t.chat._id,title:t.chat.title,lastActivity:t.chat.lastActivity,user:t.chat.user};a(u(r))}}catch(t){t.message==="Unauthorized"?(c.error("Please login and try again"),o("/login")):c.error(t)}},g=async s=>{const t=await a(C(s));m(t.payload.map(r=>({sender:r.role,content:r.content,id:r._id})))};return e.jsxs("div",{className:`sidebar ${p?"open":""}`,children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h1",{children:"Nexo"}),e.jsx("button",{className:"close-btn",onClick:()=>a(h()),children:"Ã—"})]}),e.jsx("button",{className:"new-chat-btn",onClick:j,children:"+ New Chat"}),e.jsx("div",{className:"chat-history",children:f?.map(s=>e.jsx("div",{className:`chat-item ${x?.id===s.id?"active":""}`,onClick:()=>{a(u(s)),g(s.id),window.innerWidth<768&&a(h())},children:e.jsx("span",{className:"chat-title",children:s.title})},s?.id))}),e.jsx("div",{className:"userLogin",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"avatar",children:n.name?n.name.charAt(0).toUpperCase():"U"}),e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-name",children:n.name||n.email}),e.jsx("div",{className:"user-email",children:n.email})]}),e.jsx("div",{className:"user-actions",children:e.jsx("button",{onClick:async()=>{try{(await fetch("https://nexo-chat-bot.onrender.com/api/auth/logout",{method:"POST",credentials:"include"})).ok?(i(null),o("/login")):c.error("Logout failed")}catch(s){console.log(s),c.error("Logout failed")}},children:"Logout"})})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"user-actions",children:e.jsx("button",{className:"primary",onClick:()=>{o("/login")},children:"Login"})})})})]})};export{E as default};
